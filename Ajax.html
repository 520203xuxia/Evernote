<html>
<head>
  <title>Ajax</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/305825 (zh-CN, DDL); Windows/10.0.16299 (Win64);"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="795"/>
<h1>Ajax</h1>

<div>
<span><div><div style="text-align: center;"><span style="font-size: 24pt;">Ajax</span></div><div style="text-align: left;"><ol start="1"><li>Ajax技术的核心：XMLHttpRequest对象（简称XHR），XHR为向服务器发送请求和解析服务器响应提供了流畅的接口，能够以异步方式从服务器取得更多信息，用户单击后不必刷新页面也能取得新数据。</li><li>XHR的用法：</li></ol></div><div>            var xhr=new XMLHttpRequest();//创建XHR对象</div><div>            xhr.open(&quot;get&quot;,&quot;example.php&quot;,false);//三个参数：请求类型（get、post）、请求的URL、是否异步发送请求的布尔值</div><div>                                                                   //<span style="color: rgb(106, 0, 129);">false:JavaScript代码只能等服务器响应之后才能继续执行，true：JavaScript代码不必等待响应继续执行</span></div><div>            xhr.send(null);//一个参数：作为请求主体发送的数据，如果不需要发送数据，则传入null，因为对有些浏览器来说是必须的，调用send之后，请求就会被分派到服务器</div><div><ol start="3"><li>调用send()之后，服务器响应之后，响应的数据会自动填充XHR对象的属性，相关属性如下：</li></ol><div>            responseText：作为响应主体被返回的文本。</div><div>            responseXML：如果响应的内容类型是&quot;text/xml&quot;或&quot;application/xml&quot;,这个属性中将保存包含这响应数据的XML DOM文档。非XML数据，此值为null</div><div>            status：响应的HTTP状态。（200：响应成功、304：请求的资源没有被修改，可以直接使用浏览器中缓存的版本、）</div><div>            statusText：HTTP状态说明。</div><div><ol start="4"><li>同步请求代码：</li></ol><div>            <span style="color: rgb(50, 135, 18);">var xhr=new XMLHttpRequest();</span></div><div><span style="color: rgb(50, 135, 18);">            xhr.open(&quot;get&quot;,&quot;example.php&quot;,false);</span></div><div><span style="color: rgb(50, 135, 18);">            xhr.send(null);</span></div><div><span style="color: rgb(50, 135, 18);">            if((xhr.status &gt;= 200 &amp;&amp; xhr.status &lt; 300 ) || xhr.status == 304 )</span></div><div><span style="color: rgb(50, 135, 18);">                   alert(xhr.responseText);</span></div><div><span style="color: rgb(50, 135, 18);">            else</span></div><div><span style="color: rgb(50, 135, 18);">                   alert(&quot;Request was unsuccessful:&quot;+xhr.status);</span></div><div><ol start="5"><li>异步请求可以检测XHR对象的<span style="color: rgb(106, 0, 129);">readyState</span>属性，该属性表示请求/响应过程的当前活动阶段。</li></ol><div>            0：未初始化。尚未调用open()方法。</div><div>            1：启动。已经调用open()方法，但尚未调用send()方法。</div><div>            2：发送。已经调用send()方法，但尚未接收到响应。</div><div>            3：接受。已经接受到部分响应数据。</div><div>            4：完成。已经接收到全部响应数据，而且已经可以在客户端使用了。</div><div><ol start="6"><li>只要readyState属性的值发生变化，就会触发一次readyStatechange事件，利用这个事件来检测每次状态变化后readyState的值。注意，<span style="color: rgb(186, 0, 255);">必须在调用open()之前指定onreadystatechange事件处理程序才能确保跨浏览器兼容性。</span></li><li>异步请求代码：</li></ol><div>            <span style="color: rgb(50, 135, 18);">var xhr=new XMLHttpRequest();</span></div><div><span style="color: rgb(50, 135, 18);">            xhr.onreadystatechange = function(){</span></div><div><span style="color: rgb(50, 135, 18);">                    if (xhr.readyState ==4){</span></div><div><span style="color: rgb(50, 135, 18);">                        if((xhr.status&gt;=200 &amp;&amp; xhr.status &lt;300 ) || xhr.status ==304 )</span></div><div><span style="color: rgb(50, 135, 18);">                                <span style="color: rgb(50, 135, 18);">alert(xhr.responseText);</span></span></div><div><span style="color: rgb(50, 135, 18);">                        else</span></div><div><span style="color: rgb(50, 135, 18);">                                <span style="color: rgb(50, 135, 18);">alert(&quot;Request was unsuccessful:&quot;+xhr.status);</span></span></div><div><span style="color: rgb(50, 135, 18);">                    }</span></div><div><span style="color: rgb(50, 135, 18);">            };</span></div><div><span style="color: rgb(50, 135, 18);">    </span><span style="color: rgb(50, 135, 18);">    </span><span style="color: rgb(50, 135, 18);">    xhr.open(&quot;get&quot;,&quot;example.php&quot;,true);</span><span style="line-height: 1.45;">    </span><span style="line-height: 1.45;">        </span></div><div><span style="color: rgb(50, 135, 18);">    </span><span style="color: rgb(50, 135, 18);">    </span><span style="color: rgb(50, 135, 18);">    xhr.send(null);</span></div></div></div><div><ol start="8"><li>调用xhr.abort()方法，在接收到响应之前取消异步请求。</li></ol><div>            调用这个方法后，XHR对象会停止触发事件，不再允许访问任何与响应有关的对象属性。在终止请求之后，还应该对XHR对象进行解引用操作。由于内存原因，不建议重用XHR对象。</div></div><div><ol start="9"><li>HTTP头部信息</li></ol><div>           每个HTTP请求和响应都会带有相应的头部信息，默认情况下，在发送XHR请求的同时，还会发送下列头部信息：</div><div>            Accept：</div><div>            Accept-Charset：</div><div>            Accept-Encoding：</div><div>            Accept-Language：</div><div>            Connection：</div><div>            Cookie：</div><div>            Host：</div><div>            Referer：</div><div>            User-Agent：</div><div><br/></div><div>             调用XHR对象的getResponseHeader()方法并传入头部字段名称，取得相应的响应头部信息。调用getAllResponseHeaders()方法则可以取得一个包含所有头部信息的长字符串。</div><div>            setRequestHeader必须在open()之后，send()之前。</div><div>            <img src="Ajax_files/Image.png" type="image/png" data-filename=""/></div><div>        </div><div>            <img src="Ajax_files/Image [1].png" type="image/png" data-filename=""/></div><div>            页面显示：</div><div>            <img src="Ajax_files/Image [2].png" type="image/png" data-filename=""/></div></div><div>            </div><div><ol start="10"><li>GET请求：将查询字符串参数追加到URL末尾。</li></ol><div>             使用GET请求经常会发生查询字符串的格式有问题的错误，对XHR而言，位于传入open()方法的URL末尾的每个参数的名称和值都必须使用</div><div>             encodeURIComponent(需要编码的字符串)进行编码。</div></div><div><ol start="11"><li>POST请求：</li></ol></div><div>             使用频率仅次于GET请求，通常用于向服务器发送应该被保存的数据。POST请求应该把数据作为请求的主体提交。POST请求的主体可以包含非常多的数据，而且格式不限。</div><div>             可以使用XHR来模仿表单提交，首先设置Content-Type头部信息为：application/x-www-form-urlencode，也就是表单提交时的内容类型，其次是以适当的格式创建一个字符串。</div><div>                 <span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="background-color: rgb(255, 250, 165); color: rgb(173, 0, 0);-evernote-highlight:true;">function login(){</span></span></div></div></div><blockquote style="margin: 0px 0px 0px 40px; border: none; padding: 0px;"><div><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="background-color: rgb(255, 250, 165); color: rgb(173, 0, 0);-evernote-highlight:true;">              var url = &quot;uservalidate.jsp&quot;;    </span></span></div><div><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="background-color: rgb(255, 250, 165); color: rgb(173, 0, 0);-evernote-highlight:true;">              xhr.onreadystatechange=mystatechange;           </span></span></div><div><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="background-color: rgb(255, 250, 165); color: rgb(173, 0, 0);-evernote-highlight:true;">              function mystatechange() {</span></span></div><div><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="background-color: rgb(255, 250, 165); color: rgb(173, 0, 0);-evernote-highlight:true;">              if (xhr.readyState==4) {</span></span></div><div><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="background-color: rgb(255, 250, 165); color: rgb(173, 0, 0);-evernote-highlight:true;">                    resultDiv.innerHTML =xhr.responseText;</span></span></div><div><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="background-color: rgb(255, 250, 165); color: rgb(173, 0, 0);-evernote-highlight:true;">              }</span></span></div><div><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="background-color: rgb(255, 250, 165); color: rgb(173, 0, 0);-evernote-highlight:true;">              else{</span></span></div><div><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="background-color: rgb(255, 250, 165); color: rgb(173, 0, 0);-evernote-highlight:true;">                    resultDiv.innerHTML += &quot;正在登录，请稍候......&quot;;</span></span></div><div><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="background-color: rgb(255, 250, 165); color: rgb(173, 0, 0);-evernote-highlight:true;">                }                </span></span></div><div><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="background-color: rgb(255, 250, 165); color: rgb(173, 0, 0);-evernote-highlight:true;">            }</span></span></div><div><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="background-color: rgb(255, 250, 165); color: rgb(173, 0, 0);-evernote-highlight:true;">            xhr.open(&quot;POST&quot;, url, true);</span></span></div><div><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="background-color: rgb(255, 250, 165); color: rgb(173, 0, 0);-evernote-highlight:true;">            xhr.setRequestHeader(&quot;Content-Type&quot;,&quot;application/x-www-form-urlencoded&quot;);</span></span></div><div><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="background-color: rgb(255, 250, 165); color: rgb(173, 0, 0);-evernote-highlight:true;">            var form=document.getElementById(&quot;user-info&quot;);</span></span></div><div><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="background-color: rgb(255, 250, 165); color: rgb(173, 0, 0);-evernote-highlight:true;">            xhr.send(serialize(form));</span></span></div></blockquote><div><div><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="background-color: rgb(255, 250, 165); color: rgb(173, 0, 0);-evernote-highlight:true;">          }</span></span></div><div>        表单结构：</div><div>            <img src="Ajax_files/Image [3].png" type="image/png" data-filename=""/>   </div><div>        服务器端获取数据：</div><div>            <img src="Ajax_files/Image [4].png" type="image/png" data-filename=""/></div><div><br/></div><div>            这里有个很深的bug，点击登录，页面中显示内容为：</div><div>            <img src="Ajax_files/Image [5].png" type="image/png" data-filename=""/></div><div>               并没有输出user，passwd的值，从控制台检查，发现值并没有传过去，序列化的函数serialize，单独在控制台使用，user，passwd的内容都可以取到，但是通过JavaScript调试，</div><div>                发现在<span style="line-height: 1.45;">页面中，当执行到serialize函数时，文本框的内容就空了，所以取不到值。怎么办？</span></div><div>                <img src="Ajax_files/Image [6].png" type="image/png" data-filename=""/></div><div>                其实mystatechange()中修改了resultDiv中的内容，所以获取不到文本框的内容了，只需将序列化代码放到mystatechange之前即可；</div><div>                <span style="background-color: rgb(255, 250, 165); color: rgb(173, 0, 0);-evernote-highlight:true;">function login(){</span></div><div><span style="background-color: rgb(255, 250, 165); color: rgb(173, 0, 0);-evernote-highlight:true;">                        <span style="background-color: rgb(255, 250, 165); color: rgb(173, 0, 0);-evernote-highlight:true;">var form=document.getElementById(&quot;user-info&quot;);</span></span></div><div><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="background-color: rgb(255, 250, 165); color: rgb(173, 0, 0); background-position: initial initial; background-repeat: initial initial;-evernote-highlight:true;">                        var data=</span><span style="background-color: rgb(255, 250, 165); color: rgb(173, 0, 0);-evernote-highlight:true;">serialize(form);</span><span style="background-color: rgb(255, 250, 165); color: rgb(173, 0, 0); background-position: initial initial; background-repeat: initial initial;-evernote-highlight:true;">          </span></span></div><blockquote style="margin: 0px 0px 0px 40px; border: none; padding: 0px;"><div><span style="background-color: rgb(255, 250, 165); color: rgb(173, 0, 0);-evernote-highlight:true;">              var url = &quot;uservalidate.jsp&quot;;    </span></div><div><span style="background-color: rgb(255, 250, 165); color: rgb(173, 0, 0);-evernote-highlight:true;">              xhr.onreadystatechange=mystatechange;           </span></div><div><span style="background-color: rgb(255, 250, 165); color: rgb(173, 0, 0);-evernote-highlight:true;">              function mystatechange() {</span></div><div><span style="background-color: rgb(255, 250, 165); color: rgb(173, 0, 0);-evernote-highlight:true;">              if (xhr.readyState==4) {</span></div><div><span style="background-color: rgb(255, 250, 165); color: rgb(173, 0, 0);-evernote-highlight:true;">                    resultDiv.innerHTML =xhr.responseText;</span></div><div><span style="background-color: rgb(255, 250, 165); color: rgb(173, 0, 0);-evernote-highlight:true;">              }</span></div><div><span style="background-color: rgb(255, 250, 165); color: rgb(173, 0, 0);-evernote-highlight:true;">              else{</span></div><div><span style="background-color: rgb(255, 250, 165); color: rgb(173, 0, 0);-evernote-highlight:true;">                    resultDiv.innerHTML += &quot;正在登录，请稍候......&quot;;</span></div><div><span style="background-color: rgb(255, 250, 165); color: rgb(173, 0, 0);-evernote-highlight:true;">                }                </span></div><div><span style="background-color: rgb(255, 250, 165); color: rgb(173, 0, 0);-evernote-highlight:true;">            }</span></div><div><span style="background-color: rgb(255, 250, 165); color: rgb(173, 0, 0);-evernote-highlight:true;">            xhr.open(&quot;POST&quot;, url, true);</span></div><div><span style="background-color: rgb(255, 250, 165); color: rgb(173, 0, 0);-evernote-highlight:true;">            xhr.setRequestHeader(&quot;Content-Type&quot;,&quot;application/x-www-form-urlencoded&quot;);</span><span style="background-color: rgb(255, 250, 165); color: rgb(173, 0, 0); line-height: 1.45;-evernote-highlight:true;">            </span></div><div><span style="background-color: rgb(255, 250, 165); color: rgb(173, 0, 0);-evernote-highlight:true;">            xhr.send(data);</span></div></blockquote><div><span style="background-color: rgb(255, 250, 165); color: rgb(173, 0, 0);-evernote-highlight:true;">          }</span></div><div>    页面结果</div><div><img src="Ajax_files/Image [7].png" type="image/png" data-filename="" style="background-color: rgb(255, 250, 165); color: rgb(173, 0, 0);-evernote-highlight:true;"/></div><div> 表单数据序列化</div><div><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="background-color: rgb(255, 250, 165); color: rgb(28, 51, 135);-evernote-highlight:true;">function serialize(form)</span></span></div><div><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="background-color: rgb(255, 250, 165); color: rgb(28, 51, 135);-evernote-highlight:true;">        {</span></span></div><div><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="background-color: rgb(255, 250, 165); color: rgb(28, 51, 135);-evernote-highlight:true;">            var parts=[];</span></span></div><div><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="background-color: rgb(255, 250, 165); color: rgb(28, 51, 135);-evernote-highlight:true;">            field=null;</span></span></div><div><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="background-color: rgb(255, 250, 165); color: rgb(28, 51, 135);-evernote-highlight:true;">            var i,len,j,optLen,option,optValue;</span></span></div><div><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="background-color: rgb(255, 250, 165); color: rgb(28, 51, 135);-evernote-highlight:true;">            for(i=0,len=form.elements.length;i&lt;len;i++)</span></span></div><div><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="background-color: rgb(255, 250, 165); color: rgb(28, 51, 135);-evernote-highlight:true;">            {</span></span></div><div><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="background-color: rgb(255, 250, 165); color: rgb(28, 51, 135);-evernote-highlight:true;">                field=form.elements[i];</span></span></div><div><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="background-color: rgb(255, 250, 165); color: rgb(28, 51, 135);-evernote-highlight:true;">                switch(field.type){</span></span></div><div><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="background-color: rgb(255, 250, 165); color: rgb(28, 51, 135);-evernote-highlight:true;">                    case &quot;select-one&quot;:</span></span></div><div><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="background-color: rgb(255, 250, 165); color: rgb(28, 51, 135);-evernote-highlight:true;">                    case &quot;select-multiple&quot;:</span></span></div><div><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="background-color: rgb(255, 250, 165); color: rgb(28, 51, 135);-evernote-highlight:true;">                    if(field.name.length)</span></span></div><div><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="background-color: rgb(255, 250, 165); color: rgb(28, 51, 135);-evernote-highlight:true;">                    {</span></span></div><div><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="background-color: rgb(255, 250, 165); color: rgb(28, 51, 135);-evernote-highlight:true;">                        for(j=0,optLen=field.options.length;j&lt;optLen;j++)</span></span></div><div><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="background-color: rgb(255, 250, 165); color: rgb(28, 51, 135);-evernote-highlight:true;">                        {</span></span></div><div><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="background-color: rgb(255, 250, 165); color: rgb(28, 51, 135);-evernote-highlight:true;">                            option=field.options[j];</span></span></div><div><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="background-color: rgb(255, 250, 165); color: rgb(28, 51, 135);-evernote-highlight:true;">                            if(option.selected)</span></span></div><div><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="background-color: rgb(255, 250, 165); color: rgb(28, 51, 135);-evernote-highlight:true;">                            {</span></span></div><div><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="background-color: rgb(255, 250, 165); color: rgb(28, 51, 135);-evernote-highlight:true;">                                optValue=&quot;&quot;;</span></span></div><div><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="background-color: rgb(255, 250, 165); color: rgb(28, 51, 135);-evernote-highlight:true;">                                if(option.hasAttribute)</span></span></div><div><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="background-color: rgb(255, 250, 165); color: rgb(28, 51, 135);-evernote-highlight:true;">                                {</span></span></div><div><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="background-color: rgb(255, 250, 165); color: rgb(28, 51, 135);-evernote-highlight:true;">                                    optValue=(option.hasAttribute(&quot;value&quot;)?option.value:option.text);</span></span></div><div><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="background-color: rgb(255, 250, 165); color: rgb(28, 51, 135);-evernote-highlight:true;">                                }</span></span></div><div><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="background-color: rgb(255, 250, 165); color: rgb(28, 51, 135);-evernote-highlight:true;">                                else</span></span></div><div><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="background-color: rgb(255, 250, 165); color: rgb(28, 51, 135);-evernote-highlight:true;">                                {</span></span></div><div><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="background-color: rgb(255, 250, 165); color: rgb(28, 51, 135);-evernote-highlight:true;">                                    optValue=(option.attributes[&quot;value&quot;].specified?option.value:option.text);//specified,检查属性是否有特定的值</span></span></div><div><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="background-color: rgb(255, 250, 165); color: rgb(28, 51, 135);-evernote-highlight:true;">                                }</span></span></div><div><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="background-color: rgb(255, 250, 165); color: rgb(28, 51, 135);-evernote-highlight:true;">                                parts.push(encodeURIComponent(field.name)+&quot;=&quot;+encodeURIComponent(optValue));</span></span></div><div><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="background-color: rgb(255, 250, 165); color: rgb(28, 51, 135);-evernote-highlight:true;">                            }</span></span></div><div><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="background-color: rgb(255, 250, 165); color: rgb(28, 51, 135);-evernote-highlight:true;">                        }</span></span></div><div><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="background-color: rgb(255, 250, 165); color: rgb(28, 51, 135);-evernote-highlight:true;">                    }</span></span></div><div><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="background-color: rgb(255, 250, 165); color: rgb(28, 51, 135);-evernote-highlight:true;">                    break;</span></span></div><div><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="background-color: rgb(255, 250, 165); color: rgb(28, 51, 135);-evernote-highlight:true;">                    case undefined:</span></span></div><div><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="background-color: rgb(255, 250, 165); color: rgb(28, 51, 135);-evernote-highlight:true;">                    case &quot;file&quot;:</span></span></div><div><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="background-color: rgb(255, 250, 165); color: rgb(28, 51, 135);-evernote-highlight:true;">                    case &quot;submit&quot;:</span></span></div><div><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="background-color: rgb(255, 250, 165); color: rgb(28, 51, 135);-evernote-highlight:true;">                    case &quot;reset&quot;:</span></span></div><div><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="background-color: rgb(255, 250, 165); color: rgb(28, 51, 135);-evernote-highlight:true;">                    case &quot;button&quot;:</span></span></div><div><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="background-color: rgb(255, 250, 165); color: rgb(28, 51, 135);-evernote-highlight:true;">                        break;</span></span></div><div><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="background-color: rgb(255, 250, 165); color: rgb(28, 51, 135);-evernote-highlight:true;">                    case &quot;radio&quot;:</span></span></div><div><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="background-color: rgb(255, 250, 165); color: rgb(28, 51, 135);-evernote-highlight:true;">                    case &quot;checkbox&quot;:</span></span></div><div><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="background-color: rgb(255, 250, 165); color: rgb(28, 51, 135);-evernote-highlight:true;">                        if(!field.checked)</span></span></div><div><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="background-color: rgb(255, 250, 165); color: rgb(28, 51, 135);-evernote-highlight:true;">                        {</span></span></div><div><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="background-color: rgb(255, 250, 165); color: rgb(28, 51, 135);-evernote-highlight:true;">                            break;</span></span></div><div><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="background-color: rgb(255, 250, 165); color: rgb(28, 51, 135);-evernote-highlight:true;">                        }</span></span></div><div><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="background-color: rgb(255, 250, 165); color: rgb(28, 51, 135);-evernote-highlight:true;">                    default:</span></span></div><div><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="background-color: rgb(255, 250, 165); color: rgb(28, 51, 135);-evernote-highlight:true;">                    if(field.name.length)</span></span></div><div><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="background-color: rgb(255, 250, 165); color: rgb(28, 51, 135);-evernote-highlight:true;">                    {</span></span></div><div><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="background-color: rgb(255, 250, 165); color: rgb(28, 51, 135);-evernote-highlight:true;">                        parts.push(encodeURIComponent(field.name)+&quot;=&quot;+encodeURIComponent(field.value));</span></span></div><div><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="background-color: rgb(255, 250, 165); color: rgb(28, 51, 135);-evernote-highlight:true;">                    }</span></span></div><div><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="background-color: rgb(255, 250, 165); color: rgb(28, 51, 135);-evernote-highlight:true;">                }</span></span></div><div><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="background-color: rgb(255, 250, 165); color: rgb(28, 51, 135);-evernote-highlight:true;">            }</span></span></div><div><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="background-color: rgb(255, 250, 165); color: rgb(28, 51, 135);-evernote-highlight:true;">            return parts.join(&quot;&amp;&quot;);</span></span></div><div><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="background-color: rgb(255, 250, 165); color: rgb(28, 51, 135);-evernote-highlight:true;">        }</span></span></div><div style="text-align: center;"><div>        <font style="font-size: 18pt;"><span style="color: rgb(28, 51, 135); font-size: 18pt; font-weight: bold;">XMLHttpRequest 2级</span></font></div></div><div><ol start="12"><li>FormData。</li></ol><div>           FormData类型为序列化表单以及创建与表单格式相同的数据（用户XHR传输）提供了便利。</div></div><div>           创建一个FormData对象，并向其中添加一些数据：</div><div>            <img src="Ajax_files/Image [8].png" type="image/png" data-filename=""/></div><div>            后台如何获取FormData数据呢，我现在只会读入输入流来获取：</div><div>                <img src="Ajax_files/Image [9].png" type="image/png" data-filename=""/></div><div>                StringBuilder sb = new StringBuilder();  </div></div><blockquote style="margin: 0px 0px 0px 40px; border: none; padding: 0px;"><div>          try(BufferedReader reader = request.getReader();) {  </div><div>                   char [] buff = new char[1024];  </div><div>                   int len;  </div><div>                   while((len = reader.read(buff)) != -1) {  </div><div>                            sb.append(buff,0, len);  </div><div>                   }  </div><div>          }catch (IOException e) {  </div><div>                   e.printStackTrace();  </div><div>          }</div><div>          String data=sb.toString();</div><div><br/></div><div>          out.print(&quot;data:&quot;+ data);</div></blockquote><div>            <img src="Ajax_files/Image [10].png" type="image/png" data-filename=""/></div><div><br/></div><div><br/></div><div><ol start="13"><li>超时设定</li></ol></div><div>        XHR的timeout属性，表示请求在等待相应多少ms之后就会终止，触发timeout事件，进而会调用ontimeout事件处理程序。  </div><div>         <img src="Ajax_files/Image [11].png" type="image/png" data-filename=""/></div><div>         请求终止时，会调用ontimeout事件处理程序，但此时readyState可能已经变成4了，这时会调用onreadystatechange事件处理程序，此时访问status属性，会导致错误，所以这里可</div><div>         以使用try-catch避免浏览器出错。</div><div><ol start="14"><li>overrideMimeType()方法</li></ol><div>          用于重写XHR相应的MIME类型。因为返回响应的MIME类型决定了XHR对象如何处理它。</div></div><div>            <img src="Ajax_files/Image [12].png" type="image/png" data-filename=""/></div><div>            必须在send（）方法之前，才能保证重写响应的MIME类型。</div><div><ol start="15"><li>进度事件</li></ol><div>            loadstart：在接收到响应数据的第一个字节时触发。</div><div>            progress：在接收到响应期间持续不断地触发。</div><div>            error：在请求发生错误时触发/</div><div>            abort：在因为调用abort（）方法而终止连接时触发。</div><div>            load：在接收到完整的响应数据时触发。</div><div><ol><li><span style="line-height: 1.45;">load事件</span></li></ol><div><span style="line-height: 1.45;">                    用以替代readystatechange事件，响应接收完毕后将触发load事件，因此没有必要去检查readyState属性了。</span></div></div><div><span style="line-height: 1.45;">                    <img src="Ajax_files/Image [13].png" type="image/png" data-filename=""/>    </span><span style="line-height: 1.45;">     </span></div></div><blockquote style="margin: 0px 0px 0px 40px; border: none; padding: 0px;"><div><ol start="2"><li>progress事件</li></ol></div></blockquote><blockquote style="margin: 0px 0px 0px 40px; border: none; padding: 0px;"><blockquote style="margin: 0 0 0 40px; border: none; padding: 0px;"></blockquote></blockquote><div><br/></div><div><ol start="16"><li>跨源资源共享</li></ol></div><div>            </div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div></div><div><br/></div></span>
</div></body></html> 