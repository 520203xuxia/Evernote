<html>
<head>
  <title>React 入门实例教程 - 阮一峰的网络日志</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/305825 (zh-CN, DDL); Windows/10.0.16299 (Win64);"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="764"/>
<h1>React 入门实例教程 - 阮一峰的网络日志</h1>

<div>
<span><div><br/></div><div><div><h1>React 入门实例教程</h1></div><div style="margin-top: 1em; margin-bottom: 1em;">现在最热门的前端框架，毫无疑问是 <a href="https://facebook.github.io/react/" target="_blank">React</a> 。</div><div style="margin-top: 1em; margin-bottom: 1em;">上周，基于 React 的 <a href="http://facebook.github.io/react-native/" target="_blank">React Native</a> 发布，结果一天之内，就获得了 5000 颗星，受瞩目程度可见一斑。</div><div style="margin-top: 1em; margin-bottom: 1em;">React 起源于 Facebook 的内部项目，因为该公司对市场上所有 <a href="http://www.ruanyifeng.com/blog/2015/02/mvcmvp_mvvm.html" target="_blank">JavaScript MVC 框架</a>，都不满意，就决定自己写一套，用来架设 <a href="https://instagram.com/" target="_blank">Instagram</a> 的网站。做出来以后，发现这套东西很好用，就在2013年5月<a href="http://facebook.github.io/react/blog/2013/06/05/why-react.html" target="_blank">开源</a>了。</div><div><img src="React 入门实例教程 - 阮一峰的网络日志_files/Image.png" type="image/png" data-filename="" height="160" width="576"/></div><div style="margin-top: 1em; margin-bottom: 1em;">由于 React 的设计思想极其独特，属于革命性创新，性能出众，代码逻辑却非常简单。所以，越来越多的人开始关注和使用，认为它可能是将来 Web 开发的主流工具。</div><div style="margin-top: 1em; margin-bottom: 1em;">这个项目本身也越滚越大，从最早的UI引擎变成了一整套前后端通吃的 Web App 解决方案。衍生的 React Native 项目，目标更是宏伟，希望用写 Web App 的方式去写 Native App。如果能够实现，整个互联网行业都会被颠覆，因为同一组人只需要写一次 UI ，就能同时运行在服务器、浏览器和手机（参见<a href="http://www.ruanyifeng.com/blog/2015/02/future-of-dom.html" target="_blank">《也许，DOM 不是答案》</a>）。</div><div><img src="React 入门实例教程 - 阮一峰的网络日志_files/Image.jpg" type="image/jpeg" data-filename="" height="356" width="576"/></div><div style="margin-top: 1em; margin-bottom: 1em;">既然 React 这么热门，看上去充满希望，当然应该好好学一下。从技术角度，可以满足好奇心，提高技术水平；从职业角度，有利于求职和晋升，有利于参与潜力大的项目。但是，好的 React 教程却不容易找到，这一方面因为这项技术太新，刚刚开始走红，大家都没有经验，还在摸索之中；另一方面因为 React 本身还在不断变动，API 一直在调整，至今没发布1.0版。</div><div><a href="https://github.com/ruanyf/react-demos" target="_blank"><img src="React 入门实例教程 - 阮一峰的网络日志_files/Image [1].png" type="image/png" data-filename="" height="240" width="576"/></a></div><div style="margin-top: 1em; margin-bottom: 1em;">我学习 React 时，就很苦恼。有的教程讨论一些细节问题，对入门没帮助；有的教程写得不错，但比较短，无助于看清全貌。我断断续续学了几个月，看过二十几篇教程，在这个过程中，将对自己有帮助的 Demo 都收集下来，做成了一个库 <a href="https://github.com/ruanyf/react-demos" target="_blank">React Demos</a> 。</div><div><a href="https://github.com/ruanyf/react-demos" target="_blank"><img src="React 入门实例教程 - 阮一峰的网络日志_files/Image [2].png" type="image/png" data-filename="" height="150" width="576"/></a></div><div style="margin-top: 1em; margin-bottom: 1em;">下面，我就根据<a href="https://github.com/ruanyf/react-demos" target="_blank">这个库</a>，写一篇全面又易懂的 React 入门教程。你只需要跟着每一个 Demo 做一遍，就能初步掌握 React 。当然，前提是你必须拥有基本 JavaScript 和 DOM 知识，但是你读完就会发现，React 所要求的预备知识真的很少。</div><h2>零、安装</h2><div style="margin-top: 1em; margin-bottom: 1em;">React 的安装包，可以到<a href="https://facebook.github.io/react/downloads.html" target="_blank">官网</a>下载。不过，<a href="https://github.com/ruanyf/react-demos">React Demos</a> 已经自带 React 源码，不用另外安装，只需把这个库拷贝到你的硬盘就行了。</div><blockquote><div><br/></div><div>$ git clone <a href="http://www.ruanyifeng.com/blog/2015/03/react.htmlmailto:git@github" target="_blank">git@github</a>.com:ruanyf/react-demos.git</div></blockquote><div style="margin-top: 1em; margin-bottom: 1em;">如果你没安装 git， 那就直接下载 <a href="https://github.com/ruanyf/react-demos/archive/master.zip" target="_blank">zip 压缩包</a>。</div><div><a href="https://github.com/ruanyf/react-demos" target="_blank"><img src="React 入门实例教程 - 阮一峰的网络日志_files/Image [3].png" type="image/png" data-filename="" height="373" width="576"/></a></div><div style="margin-top: 1em; margin-bottom: 1em;">下面要讲解的12个例子在各个 Demo 子目录，每个目录都有一个 index.html 文件，在浏览器打开这个文件（大多数情况下双击即可），就能立刻看到效果。</div><div style="margin-top: 1em; margin-bottom: 1em;">需要说明的是，React 可以在浏览器运行，也可以在服务器运行，但是本教程只涉及浏览器。一方面是为了尽量保持简单，另一方面 React 的语法是一致的，服务器的用法与浏览器差别不大。<a href="https://github.com/ruanyf/react-demos/tree/master/demo13">Demo13</a> 是服务器首屏渲染的例子，有兴趣的朋友可以自己去看源码。</div><h2>一、HTML 模板</h2><div style="margin-top: 1em; margin-bottom: 1em;">使用 React 的网页源码，结构大致如下。</div><blockquote><div>&lt;!DOCTYPE html&gt;</div><div>&lt;html&gt;</div><div>&lt;head&gt;</div><div>&lt;script src=&quot;../build/react.js&quot;&gt;&lt;/script&gt;</div><div>&lt;script src=&quot;../build/react-dom.js&quot;&gt;&lt;/script&gt;</div><div>&lt;script src=&quot;../build/browser.min.js&quot;&gt;&lt;/script&gt;</div><div>&lt;/head&gt;</div><div>&lt;body&gt;</div><div>&lt;div id=&quot;example&quot;&gt;&lt;/div&gt;</div><div>&lt;script type=&quot;text/babel&quot;&gt;</div><div>// ** Our code goes here! **</div><div>&lt;/script&gt;</div><div>&lt;/body&gt;</div><div>&lt;/html&gt;</div></blockquote><div style="margin-top: 1em; margin-bottom: 1em;">上面代码有两个地方需要注意。首先，最后一个 &lt;script&gt; 标签的 type 属性为 text/babel 。这是因为 React 独有的 JSX 语法，跟 JavaScript 不兼容。凡是使用 JSX 的地方，都要加上 type=&quot;text/babel&quot; 。</div><div style="margin-top: 1em; margin-bottom: 1em;">其次，上面代码一共用了三个库： react.js 、react-dom.js 和 Browser.js ，它们必须首先加载。其中，react.js 是 React 的核心库，react-dom.js 是提供与 DOM 相关的功能，Browser.js 的作用是将 JSX 语法转为 JavaScript 语法，这一步很消耗时间，实际上线的时候，应该将它放到服务器完成。</div><blockquote><div><br/></div><div>$ babel src --out-dir build</div></blockquote><div style="margin-top: 1em; margin-bottom: 1em;">上面命令可以将 src 子目录的 js 文件进行语法转换，转码后的文件全部放在 build 子目录。</div><h2>二、ReactDOM.render()</h2><div style="margin-top: 1em; margin-bottom: 1em;">ReactDOM.render 是 React 的最基本方法，用于将模板转为 HTML 语言，并插入指定的 DOM 节点。</div><blockquote><div><br/></div><div>ReactDOM.render(</div><div>&lt;h1&gt;Hello, world!&lt;/h1&gt;,</div><div>document.getElementById('example')</div><div>);</div></blockquote><div style="margin-top: 1em; margin-bottom: 1em;">上面代码将一个 h1 标题，插入 example 节点（查看 <a href="https://github.com/ruanyf/react-demos/blob/master/demo01/index.html">demo01</a>），运行结果如下。</div><div><img src="React 入门实例教程 - 阮一峰的网络日志_files/Image [4].png" type="image/png" data-filename="" height="162" width="369"/></div><h2>三、JSX 语法</h2><div style="margin-top: 1em; margin-bottom: 1em;">上一节的代码， HTML 语言直接写在 JavaScript 语言之中，不加任何引号，这就是 <a href="http://facebook.github.io/react/docs/displaying-data.html#jsx-syntax" target="_blank">JSX 的语法</a>，它允许 HTML 与 JavaScript 的混写（查看 <a href="https://github.com/ruanyf/react-demos/blob/master/demo02/index.html">Demo02</a> ）。</div><blockquote><div><br/></div><div>var names = ['Alice', 'Emily', 'Kate'];</div><div><br/></div><div>ReactDOM.render(</div><div>&lt;div&gt;</div><div>{</div><div>names.map(function (name) {</div><div>return &lt;div&gt;Hello, {name}!&lt;/div&gt;</div><div>})</div><div>}</div><div>&lt;/div&gt;,</div><div>document.getElementById('example')</div><div>);</div></blockquote><div style="margin-top: 1em; margin-bottom: 1em;">上面代码体现了 JSX 的基本语法规则：遇到 HTML 标签（以 &lt; 开头），就用 HTML 规则解析；遇到代码块（以 { 开头），就用 JavaScript 规则解析。上面代码的运行结果如下。</div><div><img src="React 入门实例教程 - 阮一峰的网络日志_files/Image [5].png" type="image/png" data-filename="" height="226" width="573"/></div><div style="margin-top: 1em; margin-bottom: 1em;">JSX 允许直接在模板插入 JavaScript 变量。如果这个变量是一个数组，则会展开这个数组的所有成员（查看 <a href="https://github.com/ruanyf/react-demos/blob/master/demo03/index.html">demo03</a> ）。</div><blockquote><div><br/></div><div>var arr = [</div><div>&lt;h1&gt;Hello world!&lt;/h1&gt;,</div><div>&lt;h2&gt;React is awesome&lt;/h2&gt;,</div><div>];</div><div>ReactDOM.render(</div><div>&lt;div&gt;{arr}&lt;/div&gt;,</div><div>document.getElementById('example')</div><div>);</div></blockquote><div style="margin-top: 1em; margin-bottom: 1em;">上面代码的arr变量是一个数组，结果 JSX 会把它的所有成员，添加到模板，运行结果如下。</div><div><img src="React 入门实例教程 - 阮一峰的网络日志_files/Image [6].png" type="image/png" data-filename="" height="194" width="455"/></div><h2>四、组件</h2><div style="margin-top: 1em; margin-bottom: 1em;">React 允许将代码封装成组件（component），然后像插入普通 HTML 标签一样，在网页中插入这个组件。React.createClass 方法就用于生成一个组件类（查看 <a href="https://github.com/ruanyf/react-demos/blob/master/demo04/index.html">demo04</a>）。</div><blockquote><div><br/></div><div>var HelloMessage = React.createClass({</div><div>render: function() {</div><div>return &lt;h1&gt;Hello {this.props.name}&lt;/h1&gt;;</div><div>}</div><div>});</div><div><br/></div><div>ReactDOM.render(</div><div>&lt;HelloMessage name=&quot;John&quot; /&gt;,</div><div>document.getElementById('example')</div><div>);</div></blockquote><div style="margin-top: 1em; margin-bottom: 1em;">上面代码中，变量 HelloMessage 就是一个组件类。模板插入 &lt;HelloMessage /&gt; 时，会自动生成 HelloMessage 的一个实例（下文的&quot;组件&quot;都指组件类的实例）。所有组件类都必须有自己的 render 方法，用于输出组件。</div><div style="margin-top: 1em; margin-bottom: 1em;">注意，<font style="color: rgb(20, 113, 145);"><b>组件类的第一个字母必须大写</b></font>，否则会报错，比如HelloMessage不能写成helloMessage。另外，组件类只能包含一个顶层标签，否则也会报错。</div><blockquote><div><br/></div><div>var HelloMessage = React.createClass({</div><div>render: function() {</div><div>return &lt;h1&gt;</div><div>Hello {this.props.name}</div><div>&lt;/h1&gt;&lt;p&gt;</div><div>some text</div><div>&lt;/p&gt;;</div><div>}</div><div>});</div></blockquote><div style="margin-top: 1em; margin-bottom: 1em;">上面代码会报错，因为HelloMessage组件包含了两个顶层标签：h1和p。</div><div style="margin-top: 1em; margin-bottom: 1em;">组件的用法与原生的 HTML 标签完全一致，可以任意加入属性，比如 &lt;HelloMessage name=&quot;John&quot;&gt; ，就是 HelloMessage 组件加入一个 name 属性，值为 John。组件的属性可以在组件类的 this.props 对象上获取，比如 name 属性就可以通过 this.props.name 读取。上面代码的运行结果如下。</div><div><img src="React 入门实例教程 - 阮一峰的网络日志_files/Image [7].png" type="image/png" data-filename="" height="201" width="432"/></div><div style="margin-top: 1em; margin-bottom: 1em;">添加组件属性，有一个地方需要注意，就是 class 属性需要写成 className ，for 属性需要写成 htmlFor ，这是因为 class 和 for 是 JavaScript 的保留字。</div><h2>五、this.props.children</h2><div style="margin-top: 1em; margin-bottom: 1em;">this.props 对象的属性与组件的属性一一对应，但是有一个例外，就是 this.props.children 属性。它表示组件的所有子节点（查看 <a href="https://github.com/ruanyf/react-demos/blob/master/demo05/index.html">demo05</a>）。</div><blockquote><div><br/></div><div>var NotesList = React.createClass({</div><div>render: function() {</div><div>return (</div><div>&lt;ol&gt;</div><div>{</div><div>React.Children.map(this.props.children, function (child) {</div><div>return &lt;li&gt;{child}&lt;/li&gt;;</div><div>})</div><div>}</div><div>&lt;/ol&gt;</div><div>);</div><div>}</div><div>});</div><div><br/></div><div>ReactDOM.render(</div><div>&lt;NotesList&gt;</div><div>&lt;span&gt;hello&lt;/span&gt;</div><div>&lt;span&gt;world&lt;/span&gt;</div><div>&lt;/NotesList&gt;,</div><div>document.body</div><div>);</div></blockquote><div style="margin-top: 1em; margin-bottom: 1em;">上面代码的 NoteList 组件有两个 span 子节点，它们都可以通过 this.props.children 读取，运行结果如下。</div><div><img src="React 入门实例教程 - 阮一峰的网络日志_files/Image [8].png" type="image/png" data-filename="" height="151" width="437"/></div><div style="margin-top: 1em; margin-bottom: 1em;">这里需要注意， this.props.children 的值有三种可能：如果当前组件没有子节点，它就是 undefined ;如果有一个子节点，数据类型是 object ；如果有多个子节点，数据类型就是 array 。所以，处理 this.props.children 的时候要小心。</div><div style="margin-top: 1em; margin-bottom: 1em;">React 提供一个工具方法 <a href="https://facebook.github.io/react/docs/top-level-api.html#react.children">React.Children</a> 来处理 this.props.children 。我们可以用 React.Children.map 来遍历子节点，而不用担心 this.props.children 的数据类型是 undefined 还是 object。更多的 React.Children 的方法，请参考<a href="https://facebook.github.io/react/docs/top-level-api.html#react.children" target="_blank">官方文档</a>。</div><h2>六、PropTypes</h2><div style="margin-top: 1em; margin-bottom: 1em;">组件的属性可以接受任意值，字符串、对象、函数等等都可以。有时，我们需要一种机制，验证别人使用组件时，提供的参数是否符合要求。</div><div style="margin-top: 1em; margin-bottom: 1em;">组件类的PropTypes属性，就是用来验证组件实例的属性是否符合要求（查看 <a href="https://github.com/ruanyf/react-demos/blob/master/demo06/index.html">demo06</a>）。</div><blockquote><div><br/></div><div>var MyTitle = React.createClass({</div><div>propTypes: {</div><div>title: React.PropTypes.string.isRequired,</div><div>},</div><div><br/></div><div>render: function() {</div><div>return &lt;h1&gt; {this.props.title} &lt;/h1&gt;;</div><div>}</div><div>});</div></blockquote><div style="margin-top: 1em; margin-bottom: 1em;">上面的Mytitle组件有一个title属性。PropTypes 告诉 React，这个 title 属性是必须的，而且它的值必须是字符串。现在，我们设置 title 属性的值是一个数值。</div><blockquote><div><br/></div><div>var data = 123;</div><div><br/></div><div>ReactDOM.render(</div><div>&lt;MyTitle title={data} /&gt;,</div><div>document.body</div><div>);</div></blockquote><div style="margin-top: 1em; margin-bottom: 1em;">这样一来，title属性就通不过验证了。控制台会显示一行错误信息。</div><blockquote><div><br/></div><div>Warning: Failed propType: Invalid prop `title` of type `number` supplied to `MyTitle`, expected `string`.</div></blockquote><div style="margin-top: 1em; margin-bottom: 1em;">更多的PropTypes设置，可以查看<a href="http://facebook.github.io/react/docs/reusable-components.html" target="_blank">官方文档</a>。</div><div style="margin-top: 1em; margin-bottom: 1em;">此外，getDefaultProps 方法可以用来设置组件属性的默认值。</div><blockquote><div><br/></div><div>var MyTitle = React.createClass({</div><div>getDefaultProps : function () {</div><div>return {</div><div>title : 'Hello World'</div><div>};</div><div>},</div><div><br/></div><div>render: function() {</div><div>return &lt;h1&gt; {this.props.title} &lt;/h1&gt;;</div><div>}</div><div>});</div><div><br/></div><div>ReactDOM.render(</div><div>&lt;MyTitle /&gt;,</div><div>document.body</div><div>);</div></blockquote><div style="margin-top: 1em; margin-bottom: 1em;">上面代码会输出&quot;Hello World&quot;。</div><h2>七、获取真实的DOM节点</h2><div style="margin-top: 1em; margin-bottom: 1em;">组件并不是真实的 DOM 节点，而是存在于内存之中的一种数据结构，叫做虚拟 DOM （virtual DOM）。只有当它插入文档以后，才会变成真实的 DOM 。根据 React 的设计，所有的 DOM 变动，都先在虚拟 DOM 上发生，然后再将实际发生变动的部分，反映在真实 DOM上，这种算法叫做 <a href="http://calendar.perfplanet.com/2013/diff/" target="_blank">DOM diff</a> ，它可以极大提高网页的性能表现。</div><div style="margin-top: 1em; margin-bottom: 1em;">但是，有时需要从组件获取真实 DOM 的节点，这时就要用到 ref 属性（查看 <a href="https://github.com/ruanyf/react-demos/blob/master/demo07/index.html" target="_blank">demo07</a> ）。</div><blockquote><div><br/></div><div>var MyComponent = React.createClass({</div><div>handleClick: function() {</div><div>this.refs.myTextInput.focus();</div><div>},</div><div>render: function() {</div><div>return (</div><div>&lt;div&gt;</div><div>&lt;input type=&quot;text&quot; ref=&quot;myTextInput&quot; /&gt;</div><div>&lt;input type=&quot;button&quot; value=&quot;Focus the text input&quot; onClick={this.handleClick} /&gt;</div><div>&lt;/div&gt;</div><div>);</div><div>}</div><div>});</div><div><br/></div><div>ReactDOM.render(</div><div>&lt;MyComponent /&gt;,</div><div>document.getElementById('example')</div><div>);</div></blockquote><div style="margin-top: 1em; margin-bottom: 1em;">上面代码中，组件 MyComponent 的子节点有一个文本输入框，用于获取用户的输入。这时就必须获取真实的 DOM 节点，虚拟 DOM 是拿不到用户输入的。为了做到这一点，文本输入框必须有一个 ref 属性，然后 this.refs.[refName] 就会返回这个真实的 DOM 节点。</div><div style="margin-top: 1em; margin-bottom: 1em;">需要注意的是，由于 this.refs.[refName] 属性获取的是真实 DOM ，所以必须等到虚拟 DOM 插入文档以后，才能使用这个属性，否则会报错。上面代码中，通过为组件指定 Click 事件的回调函数，确保了只有等到真实 DOM 发生 Click 事件之后，才会读取 this.refs.[refName] 属性。</div><div style="margin-top: 1em; margin-bottom: 1em;">React 组件支持很多事件，除了 Click 事件以外，还有 KeyDown 、Copy、Scroll 等，完整的事件清单请查看<a href="http://facebook.github.io/react/docs/events.html#supported-events" target="_blank">官方文档</a>。</div><h2>八、this.state</h2><div style="margin-top: 1em; margin-bottom: 1em;">组件免不了要与用户互动，React 的一大创新，就是将组件看成是一个状态机，一开始有一个初始状态，然后用户互动，导致状态变化，从而触发重新渲染 UI （查看 <a href="https://github.com/ruanyf/react-demos/blob/master/demo08/index.html">demo08</a> ）。</div><blockquote><div><br/></div><div>var LikeButton = React.createClass({</div><div>getInitialState: function() {</div><div>return {liked: false};</div><div>},</div><div>handleClick: function(event) {</div><div>this.setState({liked: !this.state.liked});</div><div>},</div><div>render: function() {</div><div>var text = this.state.liked ? 'like' : 'haven\'t liked';</div><div>return (</div><div>&lt;p onClick={this.handleClick}&gt;</div><div>You {text} this. Click to toggle.</div><div>&lt;/p&gt;</div><div>);</div><div>}</div><div>});</div><div><br/></div><div>ReactDOM.render(</div><div>&lt;LikeButton /&gt;,</div><div>document.getElementById('example')</div><div>);</div></blockquote><div style="margin-top: 1em; margin-bottom: 1em;">上面代码是一个 LikeButton 组件，它的 getInitialState 方法用于定义初始状态，也就是一个对象，这个对象可以通过 this.state 属性读取。当用户点击组件，导致状态变化，this.setState 方法就修改状态值，每次修改以后，自动调用 this.render 方法，再次渲染组件。</div><div style="margin-top: 1em; margin-bottom: 1em;">由于 this.props 和 this.state 都用于描述组件的特性，可能会产生混淆。一个简单的区分方法是，this.props 表示那些一旦定义，就不再改变的特性，而 this.state 是会随着用户互动而产生变化的特性。</div><h2>九、表单</h2><div style="margin-top: 1em; margin-bottom: 1em;">用户在表单填入的内容，属于用户跟组件的互动，所以不能用 this.props 读取（查看 <a href="https://github.com/ruanyf/react-demos/blob/master/demo09/index.html">demo9</a> ）。</div><blockquote><div><br/></div><div>var Input = React.createClass({</div><div>getInitialState: function() {</div><div>return {value: 'Hello!'};</div><div>},</div><div>handleChange: function(event) {</div><div>this.setState({value: event.target.value});</div><div>},</div><div>render: function () {</div><div>var value = this.state.value;</div><div>return (</div><div>&lt;div&gt;</div><div>&lt;input type=&quot;text&quot; value={value} onChange={this.handleChange} /&gt;</div><div>&lt;p&gt;{value}&lt;/p&gt;</div><div>&lt;/div&gt;</div><div>);</div><div>}</div><div>});</div><div><br/></div><div>ReactDOM.render(&lt;Input/&gt;, document.body);</div></blockquote><div style="margin-top: 1em; margin-bottom: 1em;">上面代码中，文本输入框的值，不能用 this.props.value 读取，而要定义一个 onChange 事件的回调函数，通过 event.target.value 读取用户输入的值。textarea 元素、select元素、radio元素都属于这种情况，更多介绍请参考<a href="http://facebook.github.io/react/docs/forms.html" target="_blank">官方文档</a>。</div><h2>十、组件的生命周期</h2><div style="margin-top: 1em; margin-bottom: 1em;">组件的<a href="https://facebook.github.io/react/docs/working-with-the-browser.html#component-lifecycle" target="_blank">生命周期</a>分成三个状态：</div><blockquote><ul><li>Mounting：已插入真实 DOM</li><li>Updating：正在被重新渲染</li><li>Unmounting：已移出真实 DOM</li></ul></blockquote><div style="margin-top: 1em; margin-bottom: 1em;">React 为每个状态都提供了两种处理函数，will 函数在进入状态之前调用，did 函数在进入状态之后调用，三种状态共计五种处理函数。</div><blockquote><ul><li>componentWillMount()</li><li>componentDidMount()</li><li>componentWillUpdate(object nextProps, object nextState)</li><li>componentDidUpdate(object prevProps, object prevState)</li><li>componentWillUnmount()</li></ul></blockquote><div style="margin-top: 1em; margin-bottom: 1em;">此外，React 还提供两种特殊状态的处理函数。</div><blockquote><ul><li>componentWillReceiveProps(object nextProps)：已加载组件收到新的参数时调用</li><li>shouldComponentUpdate(object nextProps, object nextState)：组件判断是否重新渲染时调用</li></ul></blockquote><div style="margin-top: 1em; margin-bottom: 1em;">这些方法的详细说明，可以参考<a href="http://facebook.github.io/react/docs/component-specs.html#lifecycle-methods" target="_blank">官方文档</a>。下面是一个例子（查看 <a href="https://github.com/ruanyf/react-demos/blob/master/demo10/index.html">demo10</a> ）。</div><blockquote><div><br/></div><div>var Hello = React.createClass({</div><div>getInitialState: function () {</div><div>return {</div><div>opacity: 1.0</div><div>};</div><div>},</div><div><br/></div><div>componentDidMount: function () {</div><div>this.timer = setInterval(function () {</div><div>var opacity = this.state.opacity;</div><div>opacity -= .05;</div><div>if (opacity &lt; 0.1) {</div><div>opacity = 1.0;</div><div>}</div><div>this.setState({</div><div>opacity: opacity</div><div>});</div><div>}.bind(this), 100);</div><div>},</div><div><br/></div><div>render: function () {</div><div>return (</div><div>&lt;div style={{opacity: this.state.opacity}}&gt;</div><div>Hello {this.props.name}</div><div>&lt;/div&gt;</div><div>);</div><div>}</div><div>});</div><div><br/></div><div>ReactDOM.render(</div><div>&lt;Hello name=&quot;world&quot;/&gt;,</div><div>document.body</div><div>);</div></blockquote><div style="margin-top: 1em; margin-bottom: 1em;">上面代码在hello组件加载以后，通过 componentDidMount 方法设置一个定时器，每隔100毫秒，就重新设置组件的透明度，从而引发重新渲染。</div><div style="margin-top: 1em; margin-bottom: 1em;">另外，组件的style属性的设置方式也值得注意，不能写成</div><blockquote><div><br/></div><div>style=&quot;opacity:{this.state.opacity};&quot;</div></blockquote><div style="margin-top: 1em; margin-bottom: 1em;">而要写成</div><blockquote><div><br/></div><div>style={{opacity: this.state.opacity}}</div></blockquote><div style="margin-top: 1em; margin-bottom: 1em;">这是因为 <a href="https://facebook.github.io/react/tips/inline-styles.html" target="_blank">React 组件样式</a>是一个对象，所以第一重大括号表示这是 JavaScript 语法，第二重大括号表示样式对象。</div><h2>十一、Ajax</h2><div style="margin-top: 1em; margin-bottom: 1em;">组件的数据来源，通常是通过 Ajax 请求从服务器获取，可以使用 componentDidMount 方法设置 Ajax 请求，等到请求成功，再用 this.setState 方法重新渲染 UI （查看 <a href="https://github.com/ruanyf/react-demos/blob/master/demo11/index.html">demo11</a> ）。</div><blockquote><div><br/></div><div>var UserGist = React.createClass({</div><div>getInitialState: function() {</div><div>return {</div><div>username: '',</div><div>lastGistUrl: ''</div><div>};</div><div>},</div><div><br/></div><div>componentDidMount: function() {</div><div>$.get(this.props.source, function(result) {</div><div>var lastGist = result[0];</div><div>if (this.isMounted()) {</div><div>this.setState({</div><div>username: lastGist.owner.login,</div><div>lastGistUrl: lastGist.html_url</div><div>});</div><div>}</div><div>}.bind(this));</div><div>},</div><div><br/></div><div>render: function() {</div><div>return (</div><div>&lt;div&gt;</div><div>{this.state.username}'s last gist is</div><div>&lt;a href={this.state.lastGistUrl}&gt;here&lt;/a&gt;.</div><div>&lt;/div&gt;</div><div>);</div><div>}</div><div>});</div><div><br/></div><div>ReactDOM.render(</div><div>&lt;UserGist source=&quot;<a href="https://api.github.com/users/octocat/gists" target="_blank">https://api.github.com/users/octocat/gists</a>&quot; /&gt;,</div><div>document.body</div><div>);</div></blockquote><div style="margin-top: 1em; margin-bottom: 1em;">上面代码使用 jQuery 完成 Ajax 请求，这是为了便于说明。React 本身没有任何依赖，完全可以不用jQuery，而使用其他库。</div><div style="margin-top: 1em; margin-bottom: 1em;">我们甚至可以把一个Promise对象传入组件，请看<a href="https://github.com/ruanyf/react-demos/blob/master/demo12/index.html">Demo12</a>。</div><blockquote><div><br/></div><div>ReactDOM.render(</div><div>&lt;RepoList</div><div>promise={$.getJSON('<a href="https://api.github.com/search/repositories" target="_blank">https://api.github.com/search/repositories</a>?q=javascript&amp;sort=stars')}</div><div>/&gt;,</div><div>document.body</div><div>);</div></blockquote><div style="margin-top: 1em; margin-bottom: 1em;">上面代码从Github的API抓取数据，然后将Promise对象作为属性，传给RepoList组件。</div><div style="margin-top: 1em; margin-bottom: 1em;">如果Promise对象正在抓取数据（pending状态），组件显示&quot;正在加载&quot;；如果Promise对象报错（rejected状态），组件显示报错信息；如果Promise对象抓取数据成功（fulfilled状态），组件显示获取的数据。</div><blockquote><div><br/></div><div>var RepoList = React.createClass({</div><div>getInitialState: function() {</div><div>return { loading: true, error: null, data: null};</div><div>},</div><div><br/></div><div>componentDidMount() {</div><div>this.props.promise.then(</div><div>value =&gt; this.setState({loading: false, data: value}),</div><div>error =&gt; this.setState({loading: false, error: error}));</div><div>},</div><div><br/></div><div>render: function() {</div><div>if (this.state.loading) {</div><div>return &lt;span&gt;Loading...&lt;/span&gt;;</div><div>}</div><div>else if (this.state.error !== null) {</div><div>return &lt;span&gt;Error: {this.state.error.message}&lt;/span&gt;;</div><div>}</div><div>else {</div><div>var repos = this.state.data.items;</div><div>var repoList = repos.map(function (repo) {</div><div>return (</div><div>&lt;li&gt;</div><div>&lt;a href={repo.html_url}&gt;{repo.name}&lt;/a&gt; ({repo.stargazers_count} stars) &lt;br/&gt; {repo.description}</div><div>&lt;/li&gt;</div><div>);</div><div>});</div><div>return (</div><div>&lt;main&gt;</div><div>&lt;h1&gt;Most Popular JavaScript Projects in Github&lt;/h1&gt;</div><div>&lt;ol&gt;{repoList}&lt;/ol&gt;</div><div>&lt;/main&gt;</div><div>);</div><div>}</div><div>}</div><div>});</div></blockquote><h2><br/></h2></div><div><br/></div></span>
</div></body></html> 